<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Secure Document Upload | Bill Layne Insurance</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">

<style>
  /* =============== MODERN DESIGN SYSTEM =============== */
  :root {
    /* Modern Color Palette */
    --primary: #5B21B6;        /* Modern Purple */
    --primary-light: #7C3AED;  /* Light Purple */
    --primary-dark: #4C1D95;   /* Dark Purple */
    --secondary: #EC4899;       /* Pink Accent */
    --accent: #06B6D4;          /* Cyan */
    --success: #10B981;         /* Emerald */
    --warning: #F59E0B;         /* Amber */
    --danger: #EF4444;          /* Red */
    
    /* Neutral Palette */
    --gray-950: #030712;
    --gray-900: #111827;
    --gray-800: #1F2937;
    --gray-700: #374151;
    --gray-600: #4B5563;
    --gray-500: #6B7280;
    --gray-400: #9CA3AF;
    --gray-300: #D1D5DB;
    --gray-200: #E5E7EB;
    --gray-100: #F3F4F6;
    --gray-50: #F9FAFB;
    --white: #FFFFFF;
    
    /* Gradients */
    --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, #FB7185 100%);
    --gradient-success: linear-gradient(135deg, var(--success) 0%, #34D399 100%);
    --gradient-dark: linear-gradient(135deg, var(--gray-900) 0%, var(--gray-800) 100%);
    --gradient-light: linear-gradient(135deg, #FFFFFF 0%, #F3F4F6 100%);
    --gradient-hero: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
    
    /* Modern Shadows */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
    --shadow-inner: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
    --shadow-glow: 0 0 40px rgba(124, 58, 237, 0.3);
    
    /* Borders & Radius */
    --radius-sm: 0.5rem;
    --radius: 0.75rem;
    --radius-lg: 1rem;
    --radius-xl: 1.5rem;
    --radius-2xl: 2rem;
    --radius-full: 9999px;
    
    /* Transitions */
    --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Backdrop Filters */
    --blur: saturate(180%) blur(20px);
    --blur-light: saturate(180%) blur(10px);
  }
  
  /* =============== RESET & BASE =============== */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: var(--gray-900);
    background: linear-gradient(to bottom right, #F0F9FF, #E0E7FF, #FCE7F3);
    background-attachment: fixed;
    line-height: 1.6;
    min-height: 100vh;
    position: relative;
  }
  
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      radial-gradient(at 20% 80%, rgb(120, 58, 237, 0.1) 0, transparent 50%),
      radial-gradient(at 80% 20%, rgb(236, 72, 153, 0.1) 0, transparent 50%),
      radial-gradient(at 40% 40%, rgb(6, 182, 212, 0.1) 0, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }
  
  /* =============== HEADER - HERO GRADIENT =============== */
  header {
    background: var(--gradient-hero);
    color: var(--white);
    padding: 3rem 0 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-xl);
  }
  
  header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shimmer 8s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .header-content {
    position: relative;
    z-index: 1;
    max-width: 800px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  
  .security-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-full);
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  .security-badge::before {
    content: '🔒';
    font-size: 1.125rem;
  }
  
  .title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.75rem;
    font-family: 'Poppins', sans-serif;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    animation: slideDown 0.5s ease-out;
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .subtitle {
    font-size: 1.125rem;
    opacity: 0.95;
    font-weight: 400;
    animation: slideDown 0.5s ease-out 0.1s backwards;
  }
  
  /* =============== CONTAINER =============== */
  .wrap {
    max-width: 800px;
    margin: -2rem auto 3rem;
    padding: 0 2rem;
    position: relative;
    z-index: 1;
  }
  
  /* =============== MODERN CARD DESIGN =============== */
  .card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-light);
    -webkit-backdrop-filter: var(--blur-light);
    border: 1px solid rgba(255, 255, 255, 0.7);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 
      0 20px 60px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 1);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    animation: fadeInUp 0.5s ease-out backwards;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .card:nth-child(2) { animation-delay: 0.1s; }
  .card:nth-child(3) { animation-delay: 0.2s; }
  .card:nth-child(4) { animation-delay: 0.3s; }
  .card:nth-child(5) { animation-delay: 0.4s; }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, transparent, rgba(124, 58, 237, 0.02), transparent);
    pointer-events: none;
  }
  
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 
      0 30px 80px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 1);
  }
  
  .card h3 {
    color: var(--gray-900);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Poppins', sans-serif;
  }
  
  .card h3::before {
    content: '';
    width: 5px;
    height: 32px;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
  }
  
  /* =============== STATUS CARD VARIATIONS =============== */
  #caseCard {
    background: rgba(255, 255, 255, 0.98);
    border-left: 4px solid var(--primary);
  }
  
  #needCard {
    background: rgba(255, 252, 245, 0.98);
    border-left: 4px solid var(--warning);
  }
  
  #uploadCard {
    background: rgba(245, 255, 249, 0.98);
    border-left: 4px solid var(--success);
  }
  
  /* =============== MODERN FORM ELEMENTS =============== */
  label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  input {
    width: 100%;
    padding: 1rem 1.25rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius);
    font-size: 1rem;
    background: var(--white);
    transition: var(--transition-fast);
    font-family: 'Inter', sans-serif;
  }
  
  input:hover {
    border-color: var(--gray-300);
  }
  
  input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 
      0 0 0 4px rgba(124, 58, 237, 0.1),
      var(--shadow-md);
    transform: translateY(-2px);
  }
  
  input[type="file"] {
    padding: 0.875rem;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.5);
  }
  
  /* =============== MODERN BUTTONS =============== */
  .btn {
    border: none;
    border-radius: var(--radius);
    padding: 1rem 2rem;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    transition: var(--transition-fast);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    position: relative;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
    isolation: isolate;
    white-space: nowrap;
  }
  
  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s;
    z-index: -1;
  }
  
  .btn:hover::before {
    transform: translateX(100%);
  }
  
  .btn-primary {
    background: var(--gradient-primary);
    color: var(--white);
    box-shadow: 
      var(--shadow-md),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }
  
  .btn-primary:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
      var(--shadow-xl),
      0 10px 30px rgba(124, 58, 237, 0.3);
  }
  
  .btn-primary:active {
    transform: translateY(0);
  }
  
  .btn-ghost {
    background: rgba(255, 255, 255, 0.9);
    color: var(--gray-700);
    border: 2px solid var(--gray-200);
    backdrop-filter: blur(10px);
  }
  
  .btn-ghost:hover {
    background: var(--white);
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
  }
  
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
    filter: grayscale(1);
  }
  
  /* =============== GRID LAYOUTS =============== */
  .row {
    display: grid;
    gap: 1rem;
  }
  
  .row-2 {
    grid-template-columns: 1fr;
  }
  
  @media (min-width: 640px) {
    .row-2 {
      grid-template-columns: 2fr 1fr;
    }
  }
  
  /* =============== MODERN PILLS =============== */
  .pill {
    display: inline-flex;
    align-items: center;
    padding: 0.625rem 1.25rem;
    border-radius: var(--radius-full);
    font-size: 0.875rem;
    font-weight: 600;
    margin: 0.375rem;
    background: var(--gradient-primary);
    color: var(--white);
    box-shadow: var(--shadow-md);
    letter-spacing: 0.025em;
    transition: var(--transition-fast);
  }
  
  .pill:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: var(--shadow-lg);
  }
  
  /* File pills with links */
  /* File pills with links */
  a.pill {
    text-decoration: none;
    background: var(--gradient-light);
    color: var(--primary);
    border: 2px solid var(--gray-200);
    display: inline-flex !important;
    visibility: visible !important;
  }
  
  a.pill:hover {
    background: var(--gradient-primary);
    color: var(--white);
    border-color: var(--primary);
    transform: translateY(-3px) scale(1.05);
  }
  
  /* =============== STATUS INDICATORS =============== */
  .ok {
    color: var(--success);
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: rgba(16, 185, 129, 0.1);
    border-radius: var(--radius);
    border: 2px solid rgba(16, 185, 129, 0.3);
  }
  
  .ok::before {
    content: '✅';
    font-size: 1.5rem;
  }
  
  .pending {
    color: var(--warning);
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: rgba(245, 158, 11, 0.1);
    border-radius: var(--radius);
    border: 2px solid rgba(245, 158, 11, 0.3);
  }
  
  .pending::before {
    content: '⏳';
    font-size: 1.5rem;
  }
  
  /* =============== MODERN UPLOAD BOX =============== */
  .upload-box {
    border: 3px dashed var(--gray-300);
    border-radius: var(--radius-xl);
    padding: 3rem 2rem;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(237, 233, 254, 0.3) 100%);
    backdrop-filter: blur(10px);
    text-align: center;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }
  
  .upload-box::before {
    content: '📄';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 8rem;
    opacity: 0.05;
    transition: var(--transition);
  }
  
  .upload-box:hover {
    border-color: var(--primary);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(237, 233, 254, 0.5) 100%);
    transform: scale(1.02);
    box-shadow: var(--shadow-lg);
  }
  
  .upload-box:hover::before {
    opacity: 0.1;
    transform: translate(-50%, -50%) rotate(10deg) scale(1.1);
  }
  
  /* =============== FILE PREVIEW =============== */
  .file-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--gradient-light);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius);
    margin-top: 1rem;
    transition: var(--transition-fast);
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  .file-preview:hover {
    box-shadow: var(--shadow-md);
    transform: translateX(5px);
    border-color: var(--primary-light);
  }
  
  .file-preview .name {
    flex: 1;
    font-weight: 500;
    color: var(--gray-800);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .file-preview .name::before {
    content: '📎';
  }
  
  .file-preview .size {
    font-size: 0.875rem;
    color: var(--gray-600);
    background: var(--gray-100);
    padding: 0.375rem 0.875rem;
    border-radius: var(--radius-full);
    font-weight: 600;
  }
  
  .file-preview .remove {
    background: var(--gradient-secondary);
    color: var(--white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 600;
    transition: var(--transition-fast);
  }
  
  .file-preview .remove:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-md);
  }
  
  /* =============== MODAL - MODERN GLASS =============== */
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .modal .box {
    width: min(500px, 90vw);
    background: var(--white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-2xl);
    padding: 2.5rem;
    text-align: center;
    animation: modalSlide 0.3s ease-out;
    border: 3px solid var(--primary);
    position: relative;
    overflow: hidden;
  }
  
  .modal .box::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(124, 58, 237, 0.05) 0%, transparent 70%);
    animation: rotate 10s linear infinite;
  }
  
  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  @keyframes modalSlide {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
  
  .modal .box > * {
    position: relative;
    z-index: 1;
  }
  
  .bar-wrap {
    width: 100%;
    background: var(--gray-200);
    border-radius: var(--radius-full);
    height: 20px;
    margin: 1.5rem 0;
    overflow: hidden;
    box-shadow: var(--shadow-inner);
  }
  
  .bar {
    height: 100%;
    width: 0%;
    background: var(--gradient-primary);
    transition: width 0.3s ease;
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
  }
  
  .bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: shimmer 2s infinite;
  }
  
  /* =============== UTILITY CLASSES =============== */
  .muted {
    opacity: 0.7;
    color: var(--gray-600);
    font-style: italic;
  }
  
  .hint {
    font-size: 0.875rem;
    color: var(--gray-600);
    margin-top: 1rem;
    padding: 1rem;
    background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
    border-radius: var(--radius);
    border-left: 4px solid var(--primary);
  }
  
  .right {
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .left {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .list {
    margin: 1rem 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .success-msg {
    background: var(--gradient-success);
    color: var(--white);
    padding: 1.25rem;
    border-radius: var(--radius);
    margin-top: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: successPulse 0.5s ease-out;
    box-shadow: var(--shadow-lg);
  }
  
  @keyframes successPulse {
    0% { transform: scale(0.95); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  .success-msg::before {
    content: '✅';
    font-size: 1.75rem;
  }
  
  /* =============== MODERN FOOTER =============== */
  .footer {
    margin-top: 4rem;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border-top: 1px solid rgba(255, 255, 255, 0.7);
    text-align: center;
    font-size: 0.95rem;
    color: var(--gray-700);
    position: relative;
  }
  
  .footer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--gradient-primary);
  }
  
  .footer a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition-fast);
    position: relative;
  }
  
  .footer a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }
  
  .footer a:hover::after {
    width: 100%;
  }
  
  /* =============== TRUST INDICATORS =============== */
  .trust-badges {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin: 2rem 0;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-xl);
    flex-wrap: wrap;
    box-shadow: var(--shadow-md);
  }
  
  .trust-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--gray-700);
    transition: var(--transition-fast);
  }
  
  .trust-badge:hover {
    transform: scale(1.05);
  }
  
  .trust-badge::before {
    font-size: 2.5rem;
    animation: float 3s ease-in-out infinite;
  }
  
  .trust-badge:nth-child(1) { animation-delay: 0s; }
  .trust-badge:nth-child(2) { animation-delay: 1s; }
  .trust-badge:nth-child(3) { animation-delay: 2s; }
  
  .trust-badge:nth-child(1)::before { content: '🔒'; }
  .trust-badge:nth-child(2)::before { content: '✅'; }
  .trust-badge:nth-child(3)::before { content: '🏆'; }
  
  /* =============== RESPONSIVE DESIGN =============== */
  @media (max-width: 640px) {
    .title {
      font-size: 1.875rem;
    }
    
    .card {
      padding: 1.5rem;
    }
    
    .btn {
      width: 100%;
      justify-content: center;
      padding: 0.875rem 1.25rem;
    }
    
    .upload-box {
      padding: 2rem 1.5rem;
    }
    
    .pill {
      font-size: 0.8rem;
      padding: 0.5rem 1rem;
    }
    
    .trust-badges {
      gap: 1rem;
    }
  }
  
  /* =============== PRINT STYLES =============== */
  @media print {
    .btn, .upload-box {
      display: none !important;
    }
    
    body {
      background: var(--white);
    }
    
    body::before {
      display: none;
    }
    
    .card {
      box-shadow: none;
      border: 1px solid var(--gray-400);
      page-break-inside: avoid;
      background: var(--white);
    }
    
    header {
      position: static;
      box-shadow: none;
      background: var(--white);
      color: var(--gray-900);
    }
  }
  
  /* =============== ACCESSIBILITY =============== */
  *:focus-visible {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
  }
  
  .small {
    font-size: 0.875rem;
    color: var(--gray-600);
    font-weight: 500;
  }
</style>
</head>
<body>
<!-- MODERN HERO HEADER -->
<header>
  <div class="header-content">
    <div class="security-badge">256-bit SSL Encrypted</div>
    <div class="title">Secure Document Upload</div>
    <div class="subtitle">Bill Layne Insurance Agency</div>
  </div>
</header>

<div class="wrap">
  <!-- TRUST INDICATORS -->
  <div class="trust-badges">
    <div class="trust-badge">
      <strong>Secure Upload</strong>
      <span>Your files are encrypted</span>
    </div>
    <div class="trust-badge">
      <strong>Verified Agency</strong>
      <span>Licensed & Insured</span>
    </div>
    <div class="trust-badge">
      <strong>Fast Processing</strong>
      <span>Documents reviewed quickly</span>
    </div>
  </div>

  <!-- ALL YOUR ORIGINAL HTML CONTENT BELOW - NO FUNCTIONALITY CHANGES -->
  
  <!-- Find Case -->
  <section class="card">
    <h3>Find Your Case</h3>
    <div class="row row-2">
      <div>
        <label>Case ID <span class="muted">(from our email)</span></label>
        <input id="caseId" placeholder="e.g., 7F3A2C91" />
      </div>
      <div class="right" style="align-items:end">
        <button class="btn btn-ghost" id="btnFindById">Open Case</button>
      </div>
    </div>
    <div class="row" style="margin-top:1rem">
      <div>
        <label>Or search by your email</label>
        <input id="email" placeholder="you@example.com" />
      </div>
      <div class="right" style="align-items:end">
        <button class="btn btn-ghost" id="btnFindByEmail">Find My Case</button>
      </div>
    </div>
    <div id="findMsg" class="muted" style="margin-top:1rem"></div>
  </section>

  <!-- Case Summary -->
  <section class="card" id="caseCard" style="display:none">
    <h3>Your Insurance Case</h3>
    <div id="who" class="muted"></div>
    <div id="tags" class="list"></div>
    <div style="margin-top:1rem"><strong>Status:</strong> <span id="status" class="pending">Pending</span></div>
    <div class="muted" style="margin-top:0.75rem">Items we may still need are shown below. You can upload files securely.</div>
  </section>

  <!-- Outstanding items -->
  <section class="card" id="needCard" style="display:none">
    <h3>Requested Documents</h3>
    <div id="needList" class="list"></div>
    <div class="hint">Please upload clear photos or PDFs of the requested documents. All uploads are secure and encrypted.</div>
  </section>

  <!-- Upload -->
  <section class="card" id="uploadCard" style="display:none">
    <h3>Upload Your Documents</h3>
    <div class="upload-box">
      <label style="font-size:1rem; text-transform:none;">Select files to upload (PDF, JPG, PNG)</label>
      
      <!-- File inputs -->
      <input id="fFiles" type="file" multiple accept=".pdf,image/*" style="margin:1rem 0" />
      <input id="fCamera" type="file" accept="image/*" capture="environment" multiple style="display:none" />

      <!-- File preview area -->
      <div id="filePreviewArea"></div>

      <div class="left" style="margin-top:1.5rem; justify-content:center">
        <button class="btn btn-ghost" id="btnOpenFiles">📁 Choose Files</button>
        <button class="btn btn-primary" id="btnOpenCamera">📸 Take Photo</button>
      </div>
      <div style="margin-top:1rem">
        <button class="btn btn-primary" id="btnUpload" disabled style="width:100%; max-width:300px">Upload Selected Files</button>
      </div>
      <div class="hint">Maximum file size: 10MB per file • Your uploads are encrypted and secure</div>
    </div>
    <div id="filesMsg" class="muted" style="margin-top:1rem"></div>
    <div id="filesList" class="list"></div>
  </section>
</div>

<!-- Upload modal -->
<div id="uploadModal" class="modal" role="dialog" aria-modal="true" aria-live="assertive">
  <div class="box">
    <div style="font-weight:800; font-size:1.5rem; background: linear-gradient(135deg, #5B21B6, #7C3AED); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom:1rem">Uploading Your Documents</div>
    <div id="modalLine" class="small" style="margin-bottom:1rem">Preparing secure upload...</div>
    <div class="bar-wrap"><div id="modalBar" class="bar"></div></div>
    <div id="modalHint" class="small">Processing <span id="fileCount">0</span> file(s) securely</div>
  </div>
</div>

<div class="footer">
  <strong>Bill Layne Insurance Agency</strong><br>
  📍 1283 N Bridge St, Elkin, NC 28621<br>
  📞 336-835-1993 • <a href="https://www.BillLayneInsurance.com" target="_blank">www.BillLayneInsurance.com</a><br>
  <div style="margin-top:1rem; font-size:0.8rem; opacity:0.8">
    © 2024 Bill Layne Insurance • All uploads are secure and confidential
  </div>
</div>

<script>
// ============= YOUR EXACT SAME JAVASCRIPT WITH FIXED renderFiles =============
// Your deployed Web App URL
const API_URL = "https://script.google.com/macros/s/AKfycbwfSB6SG_fiZ3R81FUU1qmBEjER0ydXwxXYkVDp-bbLzxjGPywgSdcU4p0MnrfAQYb42g/exec";

let CASE_ID = "";
let REQUIREMENTS = [];
let REQ_STATUS = {};
let selectedFiles = [];
let uploadedCount = 0;

/* --- helpers --- */
function el(id){return document.getElementById(id)}
function esc(s){return (s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]))}
function showModal(){ el("uploadModal").style.display = "flex"; }
function hideModal(){ el("uploadModal").style.display = "none"; }
function setModal(line, pct, count){ 
  el("modalLine").textContent = line; 
  el("modalBar").style.width = `${Math.max(0, Math.min(100, pct))}%`;
  if(count !== undefined) el("fileCount").textContent = count;
}

/* File size formatter */
function formatBytes(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

/* Convert file to base64 */
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      // Remove the data:type;base64, prefix
      const base64String = reader.result.split(',')[1];
      resolve(base64String);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* --- File Selection Management --- */
function updateFilePreview() {
  const previewArea = el("filePreviewArea");
  previewArea.innerHTML = "";
  
  if (selectedFiles.length === 0) {
    el("btnUpload").disabled = true;
    el("btnUpload").textContent = "Upload Selected Files";
    return;
  }
  
  el("btnUpload").disabled = false;
  el("btnUpload").textContent = `Upload ${selectedFiles.length} File(s)`;
  
  selectedFiles.forEach((file, index) => {
    const preview = document.createElement("div");
    preview.className = "file-preview";
    preview.innerHTML = `
      <span class="name">${esc(file.name)}</span>
      <span class="size">${formatBytes(file.size)}</span>
      <button class="remove" data-index="${index}">Remove</button>
    `;
    previewArea.appendChild(preview);
  });
  
  // Add remove handlers
  previewArea.querySelectorAll(".remove").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const idx = parseInt(e.target.dataset.index);
      selectedFiles.splice(idx, 1);
      updateFilePreview();
    });
  });
}

function handleFileSelection(files) {
  const maxSize = 10 * 1024 * 1024; // 10MB
  let errorMsg = "";
  
  Array.from(files).forEach(file => {
    if (file.size > maxSize) {
      errorMsg += `${file.name} is too large (max 10MB)<br>`;
      return;
    }
    // Avoid duplicates
    if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
      selectedFiles.push(file);
    }
  });
  
  if (errorMsg) {
    el("filesMsg").innerHTML = `<span class="error">${errorMsg}</span>`;
  }
  
  updateFilePreview();
}

/* --- UI Rendering --- */
function renderCase(d){
  CASE_ID = d.caseId;
  REQUIREMENTS = d.requirements || [];
  REQ_STATUS = d.reqStatus || {};
  uploadedCount = (d.files || []).length;

  el("caseCard").style.display = "";
  el("needCard").style.display = "";
  el("uploadCard").style.display = "";

  el("who").innerHTML = `${esc(d.name||"Customer")} • ${esc(d.product||"")} ${d.company?("• "+esc(d.company)):""} • Case <strong>${esc(CASE_ID)}</strong>`;
  el("status").textContent = d.status || "Pending";
  el("status").className = d.status==="Complete" ? "ok" : "pending";

  const tags = REQUIREMENTS.map(r=>`<span class="pill">${REQ_STATUS[r.key]===true?"✅ ":"⏳ "}${esc(r.label)}</span>`).join("");
  el("tags").innerHTML = tags;

  const outstanding = REQUIREMENTS.filter(r => REQ_STATUS[r.key]!==true);
  el("needList").innerHTML = outstanding.length ? 
    outstanding.map(r=>`<span class="pill">${esc(r.label)}</span>`).join("") : 
    `<span class="ok">You're all set — nothing outstanding!</span>`;

  renderFiles(d.files||[]);
}

// FIXED renderFiles function with better URL handling
function renderFiles(files){
  console.log("Customer page - Files received:", files); // Debug log
  console.log("filesList element exists?", el("filesList")); // Check if element exists
  
  if (!files || !files.length) {
    el("filesList").innerHTML = `<span class="muted">No files uploaded yet.</span>`;
    return;
  }
  
  const fileLinks = files.map(f => {
    console.log("Customer page - File object:", f); // Debug each file
    
    // Check if URL exists and create appropriate link
    if (f.url) {
      return `<a class="pill" href="${f.url}" target="_blank" rel="noopener" style="display:inline-flex!important;">📄 ${esc(f.name)}</a>`;
    } else if (f.id) {
      // If no URL but has ID, construct Google Drive URL
      const driveUrl = `https://drive.google.com/file/d/${f.id}/view`;
      return `<a class="pill" href="${driveUrl}" target="_blank" rel="noopener" style="display:inline-flex!important;">📄 ${esc(f.name)}</a>`;
    } else if (f.webViewLink) {
      // Another possible property from Google Drive API
      return `<a class="pill" href="${f.webViewLink}" target="_blank" rel="noopener" style="display:inline-flex!important;">📄 ${esc(f.name)}</a>`;
    } else {
      // No link available
      return `<span class="pill" style="opacity: 0.7;display:inline-flex!important;">📄 ${esc(f.name)} (processing...)</span>`;
    }
  }).join("");
  
  console.log("Generated HTML:", fileLinks); // Debug generated HTML
  el("filesList").innerHTML = fileLinks;
  console.log("filesList after update:", el("filesList").innerHTML); // Verify it was set
}

/* --- Actions --- */
async function openById(){
  const id = el("caseId").value.trim();
  if(!id){ el("findMsg").textContent = "Enter your Case ID."; return; }
  el("findMsg").textContent = "Loading…";
  
  try {
    const fd = new FormData();
    fd.append('action', 'loadById');
    fd.append('caseId', id);
    
    const response = await fetch(API_URL, { method: 'POST', body: fd });
    const r = await response.json();
    
    if(!r.ok){ 
      el("findMsg").textContent = "Case not found."; 
      return; 
    }
    
    renderCase(r);
    el("findMsg").textContent = "Case loaded.";
    history.replaceState(null, "", location.pathname + "#case="+encodeURIComponent(id));
  } catch (err) {
    el("findMsg").textContent = "Error loading case: " + err.message;
  }
}

async function openByEmail(){
  const email = el("email").value.trim();
  if(!email){ el("findMsg").textContent = "Enter your email."; return; }
  el("findMsg").textContent = "Searching…";
  
  try {
    const fd = new FormData();
    fd.append('action', 'loadByEmail');
    fd.append('email', email);
    
    const response = await fetch(API_URL, { method: 'POST', body: fd });
    const r = await response.json();
    
    if(!r.ok){ 
      el("findMsg").textContent = "No case found for that email."; 
      return; 
    }
    
    renderCase(r);
    el("findMsg").textContent = "Case loaded.";
    history.replaceState(null, "", location.pathname + "#email="+encodeURIComponent(email));
  } catch (err) {
    el("findMsg").textContent = "Error searching: " + err.message;
  }
}

/* --- WORKING Base64 Upload Method --- */
async function uploadFiles(){
  if(!CASE_ID){ 
    el("filesMsg").textContent = "Open your case first."; 
    return; 
  }
  
  if (!selectedFiles.length){ 
    el("filesMsg").textContent = "Select files to upload first."; 
    return; 
  }

  showModal();
  setModal("Preparing upload...", 10, selectedFiles.length);
  el("filesMsg").textContent = "Uploading… please wait";

  let successCount = 0;
  let failedFiles = [];

  try {
    // Upload each file individually as base64
    for (let i = 0; i < selectedFiles.length; i++) {
      const file = selectedFiles[i];
      setModal(`Uploading ${file.name}...`, 20 + (i / selectedFiles.length * 60), selectedFiles.length);
      
      try {
        // Convert to base64
        const base64 = await fileToBase64(file);
        
        // Send as FormData with base64
        const fd = new FormData();
        fd.append('action', 'upload');
        fd.append('caseId', CASE_ID);
        fd.append('file', base64);
        fd.append('file.name', file.name);
        fd.append('file.contentType', file.type || 'application/octet-stream');
        
        const response = await fetch(API_URL, { method: 'POST', body: fd });
        const data = await response.json();
        
        if (data.ok) {
          successCount++;
        } else {
          failedFiles.push(file.name);
          console.error(`Failed to upload ${file.name}:`, data.error);
        }
      } catch (err) {
        failedFiles.push(file.name);
        console.error(`Error uploading ${file.name}:`, err);
      }
    }
    
    // Show results
    setModal("Upload complete!", 100, selectedFiles.length);
    
    if (successCount === selectedFiles.length) {
      el("filesMsg").innerHTML = `<div class="success-msg">All ${successCount} file(s) uploaded successfully!</div>`;
    } else if (successCount > 0) {
      el("filesMsg").innerHTML = `<div class="success-msg">✅ ${successCount} file(s) uploaded. ❌ ${failedFiles.length} failed: ${failedFiles.join(', ')}</div>`;
    } else {
      el("filesMsg").innerHTML = `<div class="error">Upload failed. Please try again.</div>`;
    }
    
    // Clear selection if successful
    if (successCount > 0) {
      selectedFiles = [];
      updateFilePreview();
      el("fFiles").value = "";
      el("fCamera").value = "";
      
      // Reload case to show new files with debugging
      setTimeout(async () => {
        console.log("Customer page - Reloading files after upload...");
        const fd = new FormData();
        fd.append('action', 'loadById');
        fd.append('caseId', CASE_ID);
        
        try {
          const response = await fetch(API_URL, { method: 'POST', body: fd });
          const r = await response.json();
          console.log("Customer page - Reload response:", r);
          if (r.ok) {
            renderFiles(r.files || []);
          }
        } catch (err) {
          console.error('Error reloading files:', err);
        }
      }, 1500); // Increased delay to ensure backend processing
    }
    
  } catch (err) {
    console.error("Upload error:", err);
    setModal("Upload error", 0, 0);
    el("filesMsg").textContent = "Upload error: " + err.message;
  } finally {
    setTimeout(hideModal, 2000);
  }
}

/* --- Deep link parsing --- */
function parseHash(){
  const h = location.hash || "";
  const mEmail = h.match(/email=([^&]+)/);
  const mCase  = h.match(/case=([^&]+)/);
  return { 
    email: mEmail ? decodeURIComponent(mEmail[1]) : "", 
    caseId: mCase ? decodeURIComponent(mCase[1]) : "" 
  };
}

/* --- Page load --- */
window.addEventListener("load", async ()=>{
  const { email, caseId } = parseHash();
  if(email){ 
    el("email").value = email; 
    await openByEmail(); 
  } else if(caseId){ 
    el("caseId").value = caseId; 
    await openById(); 
  }
});

/* --- Event Listeners --- */
el("btnFindById").addEventListener("click", openById);
el("btnFindByEmail").addEventListener("click", openByEmail);
el("btnOpenFiles").addEventListener("click", ()=> el("fFiles").click());
el("btnOpenCamera").addEventListener("click", ()=> el("fCamera").click());
el("btnUpload").addEventListener("click", uploadFiles);

// File input change handlers
el("fFiles").addEventListener("change", (e) => {
  handleFileSelection(e.target.files);
});

el("fCamera").addEventListener("change", (e) => {
  handleFileSelection(e.target.files);
});

// Enter key support
el("caseId").addEventListener("keypress", (e) => {
  if (e.key === "Enter") openById();
});

el("email").addEventListener("keypress", (e) => {
  if (e.key === "Enter") openByEmail();
});
</script>
</body>
</html>
